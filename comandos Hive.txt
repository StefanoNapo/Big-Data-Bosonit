CREATE TABLE IF NOT EXISTS padron_txt
(COD_DISTRITO INT, DESC_DISTRITO STRING,COD_DIST_BARRIO INT, DESC_BARRIO STRING, COD_BARRIO INT,
COD_DIST_SECCION INT, COD_SECCION INT, COD_EDAD_INT INT, ESPANOLESHOMBRES INT, ESPANOLESMUJERES INT,
EXTRANJEROSHOMBRES INT,EXTRANJEROSMUJERES INT,FX_CARGA DATE, FX_DATOS_INI DATE, FX_DATOS_FIN DATE) 
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde'
WITH SERDEPROPERTIES ("separatorChar" = ";", 'quoteChar' = '\"') TBLPROPERTIES ('skip.header.line.count'='1');

LOAD DATA LOCAL INPATH '/home/cloudera/workspace/shared_files/estadisticas202212.csv' INTO TABLE padron_txt;

CREATE TABLE IF NOT EXISTS padron_txt_2 
AS SELECT COD_DISTRITO, TRIM(DESC_DISTRITO) AS DESC_DISTRITO, COD_DIST_BARRIO, TRIM(DESC_BARRIO) AS DESC_BARRIO, COD_BARRIO, COD_DIST_SECCION,
COD_SECCION, COD_EDAD_INT, ESPANOLESHOMBRES, ESPANOLESMUJERES, extranjeroshombres, extranjerosmujeres, fx_carga, fx_datos_ini, fx_datos_fin 
FROM padron_txt

select * from padron_txt where COD_DISTRITO = "" or DESC_DISTRITO = "" or COD_DIST_BARRIO = "" or COD_BARRIO = "" or 
COD_DIST_SECCION = "" or COD_SECCION = "" or COD_EDAD_INT = "" or fx_carga = "" or fx_datos_ini = "" or fx_datos_fin = ""

INSERT OVERWRITE TABLE padron_txt
SELECT COD_DISTRITO, DESC_DISTRITO, COD_DIST_BARRIO, DESC_BARRIO, COD_BARRIO, COD_DIST_SECCION,
COD_SECCION, COD_EDAD_INT, CASE WHEN LENGTH(ESPANOLESHOMBRES) = 0 THEN "0" ELSE ESPANOLESHOMBRES END AS ESPANOLESHOMBRES,
CASE WHEN LENGTH(ESPANOLESMUJERES) = 0 THEN "0" ELSE ESPANOLESMUJERES END AS ESPANOLESMUJERES,
CASE WHEN LENGTH(extranjeroshombres) = 0 THEN "0" ELSE extranjeroshombres END AS extranjeroshombres,
CASE WHEN LENGTH(extranjerosmujeres) = 0 THEN "0" ELSE extranjerosmujeres END AS extranjerosmujeres,
fx_carga, fx_datos_ini, fx_datos_fin 
FROM padron_txt



CREATE TABLE IF NOT EXISTS padron_txt_2
(COD_DISTRITO INT, DESC_DISTRITO STRING,COD_DIST_BARRIO INT, DESC_BARRIO STRING, COD_BARRIO INT,
COD_DIST_SECCION INT, COD_SECCION INT, COD_EDAD_INT INT, ESPANOLESHOMBRES INT, ESPANOLESMUJERES INT,
EXTRANJEROSHOMBRES INT,EXTRANJEROSMUJERES INT,FX_CARGA DATE, FX_DATOS_INI DATE, FX_DATOS_FIN DATE)
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde'
 WITH SERDEPROPERTIES ('separatorChar' = ';', 'input.regex'='([0-9a-zA-Z\-\:\.])')
TBLPROPERTIES ('skip.header.line.count' = '1');

LOAD DATA LOCAL INPATH '/home/cloudera/workspace/shared_files/estadisticas202212.csv' INTO TABLE padron_txt_2

SELECT * FROM padron_txt_2

INSERT OVERWRITE TABLE padron_txt_2
SELECT COD_DISTRITO, TRIM(DESC_DISTRITO) AS DESC_DISTRITO, COD_DIST_BARRIO, TRIM(DESC_BARRIO) AS DESC_BARRIO, COD_BARRIO, COD_DIST_SECCION,
COD_SECCION, COD_EDAD_INT, CASE WHEN LENGTH(ESPANOLESHOMBRES) = 0 THEN "0" ELSE ESPANOLESHOMBRES END AS ESPANOLESHOMBRES,
CASE WHEN LENGTH(ESPANOLESMUJERES) = 0 THEN "0" ELSE ESPANOLESMUJERES END AS ESPANOLESMUJERES,
CASE WHEN LENGTH(extranjeroshombres) = 0 THEN "0" ELSE extranjeroshombres END AS extranjeroshombres,
CASE WHEN LENGTH(extranjerosmujeres) = 0 THEN "0" ELSE extranjerosmujeres END AS extranjerosmujeres,
fx_carga, fx_datos_ini, fx_datos_fin 
FROM padron_txt_2



CREATE TABLE IF NOT EXISTS padron_parquet
STORED AS parquet
AS SELECT COD_DISTRITO, DESC_DISTRITO, COD_DIST_BARRIO, DESC_BARRIO, COD_BARRIO, COD_DIST_SECCION,
COD_SECCION, COD_EDAD_INT, ESPANOLESHOMBRES, ESPANOLESMUJERES, extranjeroshombres, extranjerosmujeres, CAST(fx_carga AS String) AS fx_carga,
CAST(fx_datos_ini AS String) AS fx_datos_ini, CAST(fx_datos_fin AS String) AS fx_datos_fin
FROM padron_txt;


CREATE TABLE IF NOT EXISTS padron_parquet_2
STORED AS parquet
AS SELECT COD_DISTRITO, DESC_DISTRITO, COD_DIST_BARRIO, DESC_BARRIO, COD_BARRIO, COD_DIST_SECCION,
COD_SECCION, COD_EDAD_INT, ESPANOLESHOMBRES, ESPANOLESMUJERES, extranjeroshombres, extranjerosmujeres, fx_carga, fx_datos_ini, fx_datos_fin
FROM padron_txt_2;


txt 35092080

txt_2 30575624

parquet 1239860

parquet_2 1237735

-----
([0-9a-zA-Z\-\:\.]+);([0-9a-zA-Z\-\:\.]+);([0-9a-zA-Z\-\:\.]+);([0-9a-zA-Z\-\:\.]+);([0-9a-zA-Z\-\:\.]+);
([0-9a-zA-Z\-\:\.]+);([0-9a-zA-Z\-\:\.]+);([0-9a-zA-Z\-\:\.]+);([0-9a-zA-Z\-\:\.]+);([0-9a-zA-Z\-\:\.]+);
([0-9a-zA-Z\-\:\.]+);([0-9a-zA-Z\-\:\.]+);([0-9a-zA-Z\-\:\.]+);([0-9a-zA-Z\-\:\.]+);([0-9a-zA-Z\-\:\.]+)